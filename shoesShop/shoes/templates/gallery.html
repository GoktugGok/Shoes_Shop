{% extends 'partials/main.html' %}

{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/gallery.css' %}">
<script src="{% static 'js/gallery.js' %}"></script>

<!-- Gallery Section -->
<div class="gallery-main">
   <div class="container-fluid">
      <div class="row px-lg-5">
         <!-- Left: Sidebar -->
         <div class="col-lg-3 col-xl-2 mb-4">
            <div class="filter-sidebar">
               <div class="d-flex align-items-center justify-content-between mb-4">
                  <h5 class="fw-bold m-0" style="letter-spacing: -0.5px;">Filter Results</h5>
                  <i class="bi bi-sliders2 text-muted"></i>
               </div>

               <!-- Kategoriler -->
               <div class="filter-group">
                  <button type="button" class="filter-title" data-bs-toggle="collapse"
                     data-bs-target="#categoryFilters">
                     <span>Categories</span>
                     <i class="bi bi-chevron-down"></i>
                  </button>
                  <div id="categoryFilters" class="collapse show">
                     <div class="filter-content">
                        {% for category in subcategories %}
                        <div class="filter-option">
                           <input type="checkbox" value="{{category.slug}}" name="shoesCategory"
                              id="category-{{category.id}}" onclick="filterShoes()">
                           <label for="category-{{category.id}}">{{category.title}}</label>
                        </div>
                        {% endfor %}
                     </div>
                  </div>
               </div>

               <!-- Brand -->
               <div class="filter-group">
                  <button type="button" class="filter-title collapsed" data-bs-toggle="collapse"
                     data-bs-target="#brandFilters">
                     <span>Brands</span>
                     <i class="bi bi-chevron-down"></i>
                  </button>
                  <div id="brandFilters" class="collapse">
                     <div class="filter-content">
                        {% for brand in brands %}
                        <div class="filter-option">
                           <input type="checkbox" name="brand" value="{{brand.name}}" id="brand-{{brand.id}}"
                              onclick="filterShoes()">
                           <label for="brand-{{brand.id}}">{{brand.name}}</label>
                        </div>
                        {% endfor %}
                     </div>
                  </div>
               </div>

               <!-- Size -->
               <div class="filter-group">
                  <button type="button" class="filter-title collapsed" data-bs-toggle="collapse"
                     data-bs-target="#sizeFilters">
                     <span>Available Sizes</span>
                     <i class="bi bi-chevron-down"></i>
                  </button>
                  <div id="sizeFilters" class="collapse">
                     <div class="filter-content">
                        <div class="size-grid">
                           {% for Shoes_Number in Shoes_Numbers %}
                           <div class="size-item">
                              <input type="checkbox" value="{{Shoes_Number.slug}}" name="shoesNumber"
                                 id="num-{{Shoes_Number.id}}" onclick="filterShoes()">
                              <label for="num-{{Shoes_Number.id}}">{{Shoes_Number}}</label>
                           </div>
                           {% endfor %}
                        </div>
                     </div>
                  </div>
               </div>

               <!-- Color -->
               <div class="filter-group">
                  <button type="button" class="filter-title collapsed" data-bs-toggle="collapse"
                     data-bs-target="#colorFilters">
                     <span>Color Palette</span>
                     <i class="bi bi-chevron-down"></i>
                  </button>
                  <div id="colorFilters" class="collapse">
                     <div class="filter-content">
                        {% for Color in Colors %}
                        <div class="filter-option">
                           <input name="shoesColor" value="{{Color.slug}}" type="checkbox" id="Color-{{Color.id}}"
                              onclick="filterShoes()">
                           <label for="Color-{{Color.id}}">{{Color.name}}</label>
                        </div>
                        {% endfor %}
                     </div>
                  </div>
               </div>
            </div>
         </div>

         <!-- Right: Products -->
         <div class="col-lg-9 col-xl-10">
            <div class="row align-items-center mb-5">
               <div class="col-md-6">
                  <h1 class="gallery-title mb-0">{{ category.title }}</h1>
                  <p class="text-muted mt-2 fw-medium"><span id="countS">{{shoes_all.count}}</span> items matching your
                     preference</p>
               </div>
               <div class="col-md-6 text-md-end">
                  <div class="badge bg-white text-dark p-3 rounded-4 border border-light shadow-sm">
                     <span class="text-muted small">Showing results for:</span>
                     <span class="fw-bold ms-1" id="activeCategory">{{ category.title }}</span>
                  </div>
               </div>
            </div>

            <div class="row g-4" id="shoes-container">
               {% for shoes in shoes_all %}
               <div class="col-sm-6 col-lg-4 col-xl-3">
                  <a href="{% url 'product' shoes.id %}" class="text-decoration-none">
                     <div class="product-card-v2">
                        <div class="badge-new">PREMIUM</div>
                        <div class="p-img-wrapper">
                           <img src="{{shoes.image.url}}" alt="{{shoes.name}}">
                        </div>
                        <div class="p-content">
                           <div>
                              <div class="p-category">{{ shoes.brand.name|default:"Footwear" }}</div>
                              <h3 class="p-name">{{shoes.name}}</h3>
                           </div>
                           <div class="p-footer">
                              <div class="p-price">â‚º{{shoes.price}}</div>
                              <div class="p-btn-view">
                                 <i class="bi bi-arrow-right"></i>
                              </div>
                           </div>
                        </div>
                     </div>
                  </a>
               </div>
               {% endfor %}
            </div>
         </div>
      </div>
   </div>
</div>

<script>
   const galleryConfig = {
      filterUrl: "{% url 'filter_shoes' %}",
      productUrlBase: "{% url 'product' 0 %}",
      defaultCategory: "{{ category.slug }}",
      defaultCategoryTitle: "{{ category.title }}"
   };

   // Proxy function to pass config
   function filterShoes() {
      window.applyFilterShoes(galleryConfig);
   }

   // Initialize filters on load
   $(document).ready(function () {
      window.initGalleryFilters();
   });
</script>

{% endblock %}