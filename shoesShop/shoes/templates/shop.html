{% extends 'partials/main.html' %}

{% load static %}

{% block content %}
<style>
   .shop-container {
      min-height: calc(100vh - 400px);
   }

   /* Product / bag styles (kept from shop) */
   .product-card {
      background: white;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
      border: 1px solid var(--border-color);
      display: flex;
      gap: 1rem;
      align-items: center;
      position: relative;
   }

   .product-card img {
      width: 150px;
      height: 150px;
      object-fit: cover;
      border-radius: 10px;
   }

   .product-card .price-badge {
      position: absolute;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, var(--accent-color), #059669);
      color: white;
      padding: 0.25rem 0.6rem;
      border-radius: 8px;
      font-weight: 700;
   }

   .product-details p {
      margin: 0;
   }

   .product-details h5 {
      margin: 0.25rem 0;
   }

   .bag-summary {
      background: white;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
      border: 1px solid var(--border-color);
   }

   .bag-summary h5 {
      font-weight: 700;
   }

   .btn-remove {
      border-radius: 50%;
      padding: 0.45rem;
      border: 1px solid rgba(0, 0, 0, 0.06);
   }

   .view-bag {
      background: linear-gradient(135deg, var(--accent-color), #059669);
      color: white;
      border-radius: 8px;
      padding: 0.6rem 1rem;
      font-weight: 700;
      display: inline-block;
   }

   @media (max-width: 767px) {
      .product-card {
         flex-direction: row;
      }

      .product-card img {
         width: 110px;
         height: 110px;
      }
   }
</style>

<div class="py-5">
   <div class="container py-5">
      <div class="row g-4">
         <div class="col-12 col-lg-7">
            <div class="row g-3">
               {% for sho in shoe %}
               <div class="col-12">
                  <div class="product-card">
                     <a href="{% url 'product' sho.shoe_info.id %}"><img src="{{ sho.shoe_info.image.url }}"
                           alt="{{ sho.shoe_info.name }}"></a>
                     <div class="product-details flex-grow-1 ms-3">
                        <h5 class="mb-1">{{ sho.shoe_info.name }}</h5>
                        <p class="mb-1 text-muted">Size: <strong>{{ sho.product.number }}</strong></p>
                        {% if sho.quantity and sho.quantity != 1 %}
                        <p class="mb-0 text-muted">Adet: <strong>{{ sho.quantity }}</strong></p>
                        {% endif %}
                     </div>
                     <div class="text-end d-flex flex-column align-items-end gap-2">
                        <div class="fs-6 fw-bold">{{ sho.shoe_info.price }}TL</div>
                        <a href="{% url 'cart-delete' sho.product.id %}" class="btn btn-outline-danger btn-remove"
                           aria-label="Remove"><i class="bi bi-trash"></i></a>
                     </div>
                  </div>
               </div>
               {% endfor %}
            </div>
         </div>

         <div class="col-12 col-lg-5">
            <div class="bag-summary">
               <h5>Your Bag</h5>
               <p>{{ shoe|length }} product</p>
               <p>Total Product Cost: <span class="text-danger">{{ total_price }}TL</span></p>
               <p>Total Delivery Cost: <span class="text-danger">{{ Delivery_Cost }}TL</span></p>
               <hr>
               <div class="d-flex justify-content-between align-items-center mb-2">
                  <div>Subtotal</div>
                  <div class="fw-bold">{{ total_price }}TL</div>
               </div>
               <div class="d-flex justify-content-between align-items-center mb-3">
                  <div>Delivery</div>
                  <div class="fw-bold">{{ Delivery_Cost }}TL</div>
               </div>
               <p class="fw-bold">Total: <span class="text-success">{{ Total }}TL</span></p>
               {% if Total != 0 %}
               <a href="{% url 'payment-information' user_id=request.user.id %}?total={{ Total }}"
                  class="view-bag d-inline-block mt-2">CHECKOUT</a>
               {% endif %}
            </div>
         </div>
      </div>
   </div>

   <script>
      const currentURL = window.location.pathname;
      document.querySelectorAll("#ShoesC a, .product-card a").forEach(link => {
         const productURL = link.getAttribute('href');
         if (currentURL === productURL && link.querySelector('img')) {
            link.querySelector('img').style.border = 'solid 3px #000';
            link.querySelector('img').style.borderRadius = '8px';
         }
      });
   </script>
</div>
{% endblock %}