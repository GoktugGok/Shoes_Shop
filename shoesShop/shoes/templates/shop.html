{% extends 'partials/main.html' %}

{% load static %}

{% block content %}
<style>
   :root {
      --primary-color: #334155;
      --accent-color: #0d9488;
      --secondary-color: #64748b;
      --dark-bg: #0f172a;
      --light-bg: #f1f5f9;
      --text-dark: #0f172a;
      --text-light: #64748b;
      --border-color: #cbd5e1;
   }

   * { transition: all 0.25s ease; }

   /* Navbar / header (copied from index) */
   .s {
      background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(241,245,249,0.95) 100%);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.06);
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0; z-index:1000;
   }

   .navbar { padding: 1.2rem 0; }
   .navbar-brand { color: var(--primary-color) !important; font-weight:800; font-size:1.8rem !important; letter-spacing: -0.5px; }
   .navbar-toggler { background: var(--accent-color) !important; border: none; padding: 0.5rem 0.75rem; }

   .nav-itemS { color: var(--text-dark) !important; font-weight:600; padding:0.5rem 1rem; border-radius:8px; cursor: pointer; position: relative; }

   .nav-itemS:hover { background: rgba(13,148,136,0.08); color:var(--accent-color) !important; }

   .searchId { background: linear-gradient(135deg,#fff,#f8fafc); border:2px solid var(--border-color); border-radius:12px; padding:0.75rem 1rem; }
   .searchId:focus-within { border-color: var(--accent-color); box-shadow: 0 4px 20px rgba(13,148,136,0.15); }
   .searchId input { color: var(--text-dark); }
   .searchId input::placeholder { color: var(--text-light); }

   .SearchResults { box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); border: 1px solid var(--border-color); }

   /* Category Tabs */
   .categoryHover { color: var(--text-dark) !important; font-weight: 600; padding: 0.8rem 1.5rem !important; border-radius: 8px; transition: all 0.3s ease; position: relative; }

   .categoryHover::after { content: ''; position: absolute; bottom: 0; left: 50%; width: 0; height: 3px; background: var(--accent-color); transform: translateX(-50%); transition: width 0.3s ease; }

   .categoryHover:hover { background: rgba(13, 148, 136, 0.1); color: var(--accent-color) !important; }

   .categoryHover:hover::after { width: 80%; }

   /* Product / bag styles (kept from shop) */
   .product-card { background:white; border-radius:12px; padding:1rem; box-shadow:0 6px 18px rgba(15,23,42,0.06); border:1px solid var(--border-color); display:flex; gap:1rem; align-items:center; position:relative; }
   .product-card img { width:150px; height:150px; object-fit:cover; border-radius:10px; }
   .product-card .price-badge { position:absolute; bottom:12px; left:50%; transform:translateX(-50%); background:linear-gradient(135deg,var(--accent-color),#059669); color:white; padding:0.25rem 0.6rem; border-radius:8px; font-weight:700; }

   .product-details p { margin:0; }
   .product-details h5 { margin:0.25rem 0; }

   .bag-summary { background:white; border-radius:12px; padding:1rem; box-shadow:0 6px 18px rgba(15,23,42,0.06); border:1px solid var(--border-color); }
   .bag-summary h5 { font-weight:700; }

   .btn-remove { border-radius:50%; padding:0.45rem; border:1px solid rgba(0,0,0,0.06); }
   .view-bag { background:linear-gradient(135deg,var(--accent-color),#059669); color:white; border-radius:8px; padding:0.6rem 1rem; font-weight:700; display:inline-block; }

   @media (max-width: 767px) {
     .product-card { flex-direction: row; }
     .product-card img { width:110px; height:110px; }
   }
</style>

<body style="background:var(--light-bg)">
   <div class="s">
      <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">
              <a class="navbar-brand" href="{% url 'index' %}">Shoes House</a>
              <button class="navbar-toggler"  type="button"  data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
               <i class="bi bi-list text-white fs-5"></i>
              </button>
              <div class="collapse navbar-collapse " id="navbarSupportedContent">
               
                 <!-- Cart -->
                <ul class="navbar-nav ms-auto mb-2  mb-lg-0 order-lg-1">
                  <li class="nav-item mt-auto">
                     <div class="nav-link  pb-0">
                        <a href="{% url 'myorder' %}" class="d-flex justify-content-start align-items-center text-center nav-itemS">
                            <i class="bi bi-archive fs-5 me-2"></i>
                            <div class="fs-6">MyOrder</div>
                        </a>
                     </div>
                  </li>
                  <li class="nav-item mt-auto">
                   <div class="nav-link  pb-0">
                     <a href="{% url 'cart' user.id|default_if_none:"0" %}" class="d-flex justify-content-start align-items-center text-center nav-itemS">
                        <i class="bi bi-cart3 fs-5 me-2"></i>
                        <div class="fs-6">Cart</div>
                    </a>
                    
                   </div>
                </li>
                   <!-- User -->
                  <li class="nav-item my-auto">
                     <div class="nav-link  mt-0 pb-0">
                        {% if request.user.is_authenticated %}
                           <a href="{% url 'user_update' %}" class="d-flex justify-content-start align-items-center text-center nav-itemS">
                              <i class="bi bi-person-circle fs-5 me-2"></i>
                              <div class="fs-6">{{ request.user.username }}</div>
                           </a>
                        {% else %}
                           <a href="{% url 'login' %}" class="d-flex justify-content-start align-items-center text-center nav-itemS">
                              <i class="bi bi-box-arrow-in-right fs-5 me-2"></i>
                              <div class="fs-6">Login</div>
                           </a>
                        {% endif %}
   
                     </div>
                  </li>
                </ul>
          
                <!-- Search -->
                <div class="w-100 position-relative dropdown ms-lg-3 me-lg-4">
                  <form id="searchId" class="d-flex w-100 searchId" role="search">
                    {% csrf_token %}
                    <i class="bi bi-search p-1 fs-5 mx-2" style="color: #0d9488;"></i>
                    <input class="border-0 w-100" autocomplete="off" name="q" id="searchInput" type="search" placeholder="Search shoes..." oninput="getSearchResults()" aria-label="Search" style="background: transparent; color: var(--text-dark);">
                  </form>
                  <ul id="searchResults" class="rounded-3 p-0 position-absolute top-100 start-0 bg-white z-3 border SearchResults mt-2 w-100" style="box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);">
                  </ul>
                </div>
              </div>
            </div>
          </nav>
         <div class="d-flex justify-content-center border-bottom align-items-center py-3" style="background: linear-gradient(90deg, rgba(255,255,255,1) 0%, rgba(248,250,252,1) 100%);">
         {% for all_category in all_categories %}
            <a href="{% url 'gallery_by_category' all_category.slug %}" class="h6 text-center ms-3 ms-lg-4 mb-0 categoryHover">{{all_category.title}}</a>
         {% endfor %}
         </div>
      </div>

   <div class="container py-5">
      <div class="row g-4">
         <div class="col-12 col-lg-7">
            <div class="row g-3">
               {% for sho in shoe %}
                  <div class="col-12">
                     <div class="product-card">
                        <a href="{% url 'product' sho.shoe_info.id %}"><img src="{{ sho.shoe_info.image.url }}" alt="{{ sho.shoe_info.name }}"></a>
                        <div class="product-details flex-grow-1 ms-3">
                           <h5 class="mb-1">{{ sho.shoe_info.name }}</h5>
                           <p class="mb-1 text-muted">Size: <strong>{{ sho.product.number }}</strong></p>
                           {% if sho.quantity and sho.quantity != 1 %}
                              <p class="mb-0 text-muted">Adet: <strong>{{ sho.quantity }}</strong></p>
                           {% endif %}
                        </div>
                        <div class="text-end d-flex flex-column align-items-end gap-2">
                           <div class="fs-6 fw-bold">{{ sho.shoe_info.price }}TL</div>
                           <a href="{% url 'cart-delete' sho.product.id %}" class="btn btn-outline-danger btn-remove" aria-label="Remove"><i class="bi bi-trash"></i></a>
                        </div>
                     </div>
                  </div>
               {% endfor %}
            </div>
         </div>

         <div class="col-12 col-lg-5">
            <div class="bag-summary">
               <h5>Your Bag</h5>
               <p>{{ shoe|length }} product</p>
               <p>Total Product Cost: <span class="text-danger">{{ total_price }}TL</span></p>
               <p>Total Delivery Cost: <span class="text-danger">{{ Delivery_Cost }}TL</span></p>
                  <hr>
               <div class="d-flex justify-content-between align-items-center mb-2">
                  <div>Subtotal</div>
                  <div class="fw-bold">{{ total_price }}TL</div>
               </div>
               <div class="d-flex justify-content-between align-items-center mb-3">
                  <div>Delivery</div>
                  <div class="fw-bold">{{ Delivery_Cost }}TL</div>
               </div>
               <p class="fw-bold">Total: <span class="text-success">{{ Total }}TL</span></p>
               {% if Total != 0 %}
                  <a href="{% url 'payment-information' user_id=request.user.id %}?total={{ Total }}" class="view-bag d-inline-block mt-2">CHECKOUT</a>
               {% endif %}
            </div>
         </div>
      </div>
   </div>

   <script>
      const currentURL = window.location.pathname;
      document.querySelectorAll("#ShoesC a, .product-card a").forEach(link => {
         const productURL = link.getAttribute('href');
         if (currentURL === productURL && link.querySelector('img')) {
            link.querySelector('img').style.border = 'solid 3px #000';
            link.querySelector('img').style.borderRadius = '8px';
         }
      });
   </script>

   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
   {% endblock %}
      